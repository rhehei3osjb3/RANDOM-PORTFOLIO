<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Portfolio debug loader</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root{--bg1:#03030a;--bg2:#07102a;--n1:#ff6ec7;--n2:#7b61ff;--n3:#00d4ff}
  *{box-sizing:border-box} html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#eaf6ff}
  /* hero overlay (topmost) */
  .hero-overlay{position:fixed;inset:0;z-index:99999;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.08));pointer-events:auto}
  .hero-box{max-width:1400px;padding:24px;text-align:center}
  .hero-text{font-family:Orbitron,Inter;font-weight:900;font-size:clamp(42px,10vw,132px);color:transparent;-webkit-text-stroke:1.6px rgba(2,2,6,0.55);filter:drop-shadow(0 12px 80px rgba(123,97,255,0.12))}
  .hero-text .fill{background:linear-gradient(90deg,var(--n1),var(--n2),var(--n3));-webkit-background-clip:text;background-clip:text;color:transparent;padding:6px 10px}
  .underline{display:block;margin-top:12px;width:84%;max-width:920px;margin-left:auto;margin-right:auto}
  .underline span{display:block;height:4px;margin:6px 0;background:linear-gradient(90deg,var(--n2),var(--n3));border-radius:3px;box-shadow:0 8px 28px rgba(123,97,255,0.12)}
  .half{overflow:hidden;height:52vh;display:flex;align-items:center;justify-content:center}
  .hero-overlay.split .half.top{transform:translateY(-110%);transition:transform .68s cubic-bezier(.22,.9,.2,1)}
  .hero-overlay.split .half.bottom{transform:translateY(110%);transition:transform .68s cubic-bezier(.22,.9,.2,1)}
  .hero-overlay.collapse{transform:translateY(-28vh) scale(.26);transition:transform .72s cubic-bezier(.22,.9,.2,1);}
  /* top control panel for debug */
  .panel{position:fixed;left:18px;top:18px;z-index:999999;background:rgba(0,0,0,0.5);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .panel input{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:6px 8px;color:#fff;border-radius:6px;margin:0 6px}
  .panel button{padding:6px 10px;border-radius:8px;background:linear-gradient(90deg,var(--n2),var(--n3));border:none;color:#fff;cursor:pointer;font-weight:700}
  main{max-width:1100px;margin:120px auto;padding:20px;visibility:hidden}
  .gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px}
  .card{border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));box-shadow:0 10px 60px rgba(0,0,0,0.6);cursor:pointer}
  .frame{height:180px;display:flex;align-items:center;justify-content:center}
  .frame img{max-width:100%;max-height:100%;object-fit:cover;display:block}
  #debugList{max-height:320px;overflow:auto;background:rgba(0,0,0,0.45);padding:8px;border-radius:8px;margin-top:10px}
  .dbg-row{display:flex;gap:8px;align-items:center;padding:6px;border-bottom:1px solid rgba(255,255,255,0.02);font-size:13px}
  .ok{color:#9ef6b3} .bad{color:#ff9ea6}
  .small{font-size:12px;color:#cfdfff}
  .lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(0,0,0,0.85),rgba(0,0,0,0.95));z-index:999998}
  .lightbox.open{display:flex}
  .lightbox img{max-width:95vw;max-height:88vh;border-radius:10px}
  .controls{display:flex;gap:10px;margin-top:8px}
  .controls button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:#fff;cursor:pointer}
  footer{color:rgba(255,255,255,0.9);text-align:center;margin:60px 0 120px}
  #status{position:fixed;right:18px;top:18px;background:rgba(0,0,0,0.46);padding:8px 12px;border-radius:10px;font-weight:700;z-index:999999;color:#dfeeff}
  @media (max-width:640px){.frame{height:120px}}
</style>
</head>
<body>

<!-- top debug panel -->
<div class="panel" id="panel">
  <label class="small">Owner</label><input id="owner" placeholder="github user/org" />
  <label class="small">Repo</label><input id="repo" placeholder="repo name" />
  <label class="small">Path (opt)</label><input id="path" placeholder="images/ or leave blank" />
  <button id="loadBtn">Load repo images</button>
  <div style="margin-top:8px">
    <input id="rawInput" placeholder="paste single raw image URL to test" style="width:370px"/>
    <button id="addRaw">Add raw URL</button>
  </div>
  <div class="small" style="margin-top:6px;color:#d0e6ff">Tip: paste owner & repo then press Load. If private repo, see token note below.</div>
  <div class="small" style="margin-top:6px">Optional token for private repos: set GITHUB_TOKEN in the script (see comments)</div>
</div>

<!-- status -->
<div id="status">idle</div>

<!-- hero overlay (covers everything) -->
<div class="hero-overlay" id="heroOverlay" aria-hidden="false">
  <div class="hero-box">
    <div class="half top"><div class="hero-text"><span class="fill" id="heroTop">WELCOME TO MY PORTFOLIO<div class="underline"><span></span><span></span><span></span></div></span></div></div>
    <div class="half bottom"><div class="hero-text"><span class="fill" id="heroBot">WELCOME TO MY PORTFOLIO<div class="underline"><span></span><span></span><span></span></div></span></div></div>
  </div>
</div>

<main id="mainContent" aria-hidden="true">
  <h1 style="font-family:Orbitron,Inter;margin-bottom:6px">Portfolio</h1>
  <div class="gallery" id="gallery"></div>

  <h3 style="margin-top:28px">Debug — attempted URLs</h3>
  <div id="debugList"></div>

  <footer>contact me on discord <strong>random698</strong></footer>
</main>

<div class="lightbox" id="lightbox" aria-hidden="true"><div style="text-align:center"><img id="lightboxImg"/><div class="controls"><button id="prevBtn">← Prev</button><button id="nextBtn">Next →</button><button id="closeBtn">Close</button></div></div></div>

<script>
/*
  Debug loader script.

  If your repo is PRIVATE: create a GitHub Personal Access Token with 'repo' scope and paste as GITHUB_TOKEN (temporarily) in this script.
  (Don't share the token publicly.)
*/
const GITHUB_TOKEN = ""; // <--- optional, use only if you understand. Leave empty for public repos.

const MAX_IMAGES = 400;
const CONCURRENCY = 12;
const IMAGE_TIMEOUT = 7000;

const ownerInput = document.getElementById('owner'), repoInput = document.getElementById('repo'), pathInput = document.getElementById('path');
const loadBtn = document.getElementById('loadBtn'), addRaw = document.getElementById('addRaw'), rawInput = document.getElementById('rawInput');
const statusEl = document.getElementById('status');
const heroOverlay = document.getElementById('heroOverlay'), mainContent = document.getElementById('mainContent');
const gallery = document.getElementById('gallery'), debugList = document.getElementById('debugList');
const lightbox = document.getElementById('lightbox'), lightboxImg = document.getElementById('lightboxImg');
const prevBtn = document.getElementById('prevBtn'), nextBtn = document.getElementById('nextBtn'), closeBtn = document.getElementById('closeBtn');

let images = [], currIndex = 0, attempts = [];

/* small helper to set status */
function setStatus(t){ statusEl.textContent = t; }

/* Fit hero text to avoid overlap */
function fitHero(){
  const top = document.getElementById('heroTop'), bot = document.getElementById('heroBot');
  const w = Math.min(window.innerWidth * 0.94, 1400);
  [top,bot].forEach(el=>{
    el.style.transform = 'scale(1)';
    const rect = el.getBoundingClientRect();
    if(rect.width > w){
      const s = (w / rect.width) * 0.98;
      el.style.transform = `scale(${s})`;
    }
  });
}

/* show hero -> cut -> collapse -> reveal main */
async function heroSeq(){
  document.body.style.overflow = 'hidden';
  mainContent.style.visibility = 'hidden'; mainContent.setAttribute('aria-hidden','true');
  fitHero();
  await delay(900);
  heroOverlay.classList.add('split');
  await delay(420);
  heroOverlay.classList.add('collapse');
  await delay(520);
  // reveal header+main
  mainContent.style.visibility = 'visible'; mainContent.setAttribute('aria-hidden','false');
  document.body.style.overflow = 'auto';
  // hide hero entirely after animation
  await delay(420);
  heroOverlay.remove();
}

/* small delay helper */
function delay(ms){ return new Promise(r=>setTimeout(r,ms)); }

/* try to load image (with timeout) */
function tryLoadImage(url, timeout=IMAGE_TIMEOUT){
  return new Promise((resolve)=>{
    const img = new Image();
    let done = false;
    const t = setTimeout(()=>{ if(done) return; done = true; img.src=''; resolve({ok:false,error:'timeout'}); }, timeout);
    img.onload = ()=>{ if(done) return; done=true; clearTimeout(t); resolve({ok:true}); };
    img.onerror = ()=>{ if(done) return; done=true; clearTimeout(t); resolve({ok:false,error:'error'}); };
    // add cache buster to avoid cached 404s
    img.src = url + (url.includes('?') ? '&_=' : '?_=') + Date.now();
  });
}

/* append debug row */
function addDebugRow(url, ok, err){
  const row = document.createElement('div'); row.className='dbg-row';
  const status = document.createElement('div'); status.textContent = ok? 'OK':'FAIL'; status.className = ok? 'ok':'bad';
  const link = document.createElement('a'); link.textContent = url.split('/').slice(-2).join('/'); link.href = url; link.target='_blank'; link.style.color = ok? '#b8ffd0' : '#ffd7dd';
  const detail = document.createElement('div'); detail.textContent = err? err : ''; detail.className='small'; detail.style.marginLeft='8px';
  row.appendChild(status); row.appendChild(link); row.appendChild(detail); debugList.appendChild(row);
  // auto-scroll to bottom
  debugList.scrollTop = debugList.scrollHeight;
}

/* render gallery with successful urls */
function renderGallery(urls){
  gallery.innerHTML = '';
  urls.forEach((u,i)=>{
    const card = document.createElement('div'); card.className='card';
    const frame = document.createElement('div'); frame.className='frame';
    const img = document.createElement('img'); img.src = u; img.alt = `img ${i+1}`;
    frame.appendChild(img); card.appendChild(frame);
    card.addEventListener('click', ()=> openLightbox(i));
    gallery.appendChild(card);
  });
}

/* Lightbox */
function openLightbox(i){ currIndex = i; lightboxImg.src = images[i]; lightbox.classList.add('open'); lightbox.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
function closeLightbox(){ lightbox.classList.remove('open'); lightbox.setAttribute('aria-hidden','true'); document.body.style.overflow='auto'; }
function nextImg(){ if(!images.length) return; currIndex = (currIndex+1)%images.length; lightboxImg.src = images[currIndex]; }
function prevImg(){ if(!images.length) return; currIndex = (currIndex-1+images.length)%images.length; lightboxImg.src = images[currIndex]; }
prevBtn.addEventListener('click', prevImg); nextBtn.addEventListener('click', nextImg); closeBtn.addEventListener('click', closeLightbox);
document.addEventListener('keydown', (e)=>{ if(lightbox.classList.contains('open')){ if(e.key==='Escape') closeLightbox(); if(e.key==='ArrowRight') nextImg(); if(e.key==='ArrowLeft') prevImg(); } });

/* Attempt to gather images from repo using git tree recursive.
   Will attempt to load raw.githubusercontent URLs for candidate blobs.
*/
async function loadRepoImages(owner, repo, path=''){
  debugList.innerHTML = ''; images = []; attempts = [];
  setStatus('scanning repo...');
  // basic validation
  if(!owner || !repo){ setStatus('enter owner & repo'); return; }
  try {
    const headers = {}; if(GITHUB_TOKEN) headers['Authorization'] = 'token ' + GITHUB_TOKEN;
    // get repo details (default branch)
    const repoRes = await fetch(`https://api.github.com/repos/${owner}/${repo}`, {headers});
    if(!repoRes.ok){ setStatus('repo fetch failed: ' + repoRes.status); debugList.innerHTML = '<div class="dbg-row bad">Repo fetch failed — check owner/repo or token</div>'; return; }
    const rjson = await repoRes.json();
    const branch = rjson.default_branch || 'main';
    // fetch tree recursively
    setStatus('fetching repo tree...');
    const treeRes = await fetch(`https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`, {headers});
    if(!treeRes.ok){ setStatus('tree fetch failed: ' + treeRes.status); debugList.innerHTML = '<div class="dbg-row bad">Tree fetch failed — possible rate-limit or repo access issue</div>'; return; }
    const treeJson = await treeRes.json();
    const nodes = Array.isArray(treeJson.tree) ? treeJson.tree : [];
    // choose candidate blobs: extension match OR name contains 'image' OR filename includes 'img' or common upload patterns
    const candidates = [];
    for(const node of nodes){
      if(node.type !== 'blob') continue;
      const p = node.path;
      if(path && !p.startsWith(path)) continue;
      const lower = p.toLowerCase();
      if(/\.(png|jpe?g|gif|webp|svg)$/i.test(lower) || lower.includes('_image') || lower.includes('/image') || lower.includes('image_') || /(^|\b)img\b/.test(lower) || lower.includes('uploads') ) {
        candidates.push(p);
      }
    }
    // If no candidates found, fallback to scanning all blobs (but cap)
    if(candidates.length === 0){
      console.warn('no candidates from heuristics, fallback to scanning blobs (cap 400)');
      for(const node of nodes){
        if(node.type !== 'blob') continue;
        const p = node.path;
        if(path && !p.startsWith(path)) continue;
        candidates.push(p);
        if(candidates.length >= 800) break;
      }
    }
    setStatus(`found ${candidates.length} files — testing...`);
    // attempt loads with concurrency
    const branchBase = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/`;
    let idx = 0;
    const loaded = [];
    async function worker(){
      while(idx < candidates.length && loaded.length < MAX_IMAGES){
        const i = idx++;
        const p = candidates[i];
        const url = branchBase + p;
        const res = await tryLoadImage(url, IMAGE_TIMEOUT);
        attempts.push({path:p, url, ok: !!res.ok, error: res.error || null});
        addDebugRow(url, !!res.ok, res.error || '');
        if(res.ok) loaded.push(url);
      }
    }
    const pool = Array.from({length:CONCURRENCY}, ()=>worker());
    await Promise.all(pool);
    setStatus(`loaded ${loaded.length} images`);
    images = loaded;
    renderGallery(images);
    if(images.length === 0){
      setStatus('no images loaded — try raw url test or check repo privacy/branch');
      debugList.insertAdjacentHTML('beforeend','<div class="dbg-row small">If repo is private or rate-limited, set a GitHub token in the script (GITHUB_TOKEN) or paste raw URLs below.</div>');
    } else {
      setStatus(`ready — ${images.length} images`);
    }
  } catch (err){
    console.error(err); setStatus('error: ' + (err.message || err));
    debugList.insertAdjacentHTML('beforeend','<div class="dbg-row bad">Unexpected error — open DevTools console for details.</div>');
  }
}

/* manual raw URL add */
async function testAndAddRaw(rawUrl){
  setStatus('testing raw URL...');
  const ok = await tryLoadImage(rawUrl, IMAGE_TIMEOUT);
  addDebugRow(rawUrl, !!ok.ok, ok.error || '');
  if(ok.ok){ images.push(rawUrl); renderGallery(images); setStatus('added raw URL'); } else { setStatus('raw URL failed'); }
}

/* button handlers */
loadBtn.addEventListener('click', async ()=>{
  const owner = (ownerInput.value||'').trim(), repo = (repoInput.value||'').trim(), path = (pathInput.value||'').trim();
  await loadRepoImages(owner, repo, path);
});
addRaw.addEventListener('click', async ()=>{
  const u = (rawInput.value||'').trim(); if(!u) return; await testAndAddRaw(u);
});

/* initial hero sequence (remove hero after) */
document.addEventListener('DOMContentLoaded', ()=>{ heroSeq(); setStatus('idle'); fitHero(); });

window.addEventListener('resize', fitHero);
</script>
</body>
</html>
